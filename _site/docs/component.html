<!DOCTYPE html>
<html lang=" zh-CN ">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Personal Space Game</title>
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/static/icon.png">
    <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.12.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5e158f966719b70012374cbf&product=inline-follow-buttons" async="async"></script>
    <script type="text/javascript">
        hljs.initHighlightingOnLoad();
    </script>
</head>

<body class="sideNavVisible">
  <div class="fixedHeaderContainer">
  <div class="headerWrapper wrapper">
    <header>
      <a href="/">
        <img class="logo" src="/static/icon.png">
        <h2 class="headerTitle">Personal Space</h2>
      </a>
      <div class="navigationWrapper navigationSlider">
        <nav class="slidingNav">
          <ul class="nav-site nav-site-internal">
            <li>
              <a href="" target="">
                Common Issues
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </header>
  </div>
</div>
  <div class="navPusher">
    <div class="docMainWrapper wrapper">
      <div class="container docsNavContainer" id="docsNav">
        <nav class="toc">
          <div class="toggleNav">
            <section class="navWrapper wrapper">
              <div class="navBreadcrumb wrapper">
                <div class="navToggle" id="navToggler">
                  <i></i>
                </div>
                <h2>
                  <i>›</i>
                  <span>组件托管</span>
                </h2>
              </div>
              <div class="navGroups">

                

                
                <div class="navGroup navGroupActive">
                  <h3>介绍</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="why-blade.html">为什么是 Blade ?</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="blade-design.html">Blade 设计</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>快速入门</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="create-application.html">创建一个工程</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="create-route.html">创建路由</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="add-static-file.html">添加静态文件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="render-view.html">渲染视图</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>指南</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="installation.html">安装 Blade</a>
                    </li>
                    
                    <li class="navListItem navItemActive">
                      <a class="navItem navItemActive" href="component.html">组件托管</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="route.html">路由注册</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="route-context.html">路由上下文</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="request.html">HTTP 请求</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="response.html">HTTP 响应</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="webhook.html">WebHook</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="configuration.html">配置文件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="templates.html">模板视图</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="logging.html">日志输出</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="package-deploy.html">打包部署</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>进阶</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="exception.html">异常处理</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="schedule.html">定时任务</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="error-page.html">错误页面</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="listen-event.html">监听事件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="session-ext.html">Session 扩展</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="custom-middleware.html">自定义中间件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="cli-args.html">命令行参数</a>
                    </li>
                    
                  </ul>
                </div>
                
              </div>
            </section>
          </div>
          <script>
            var toggler = document.getElementById('navToggler');
            var nav = document.getElementById('docsNav');
            toggler.onclick = function () {
              nav.classList.toggle('docsSliderActive');
            };
          </script>
        </nav>
      </div>
      <div class="container mainContainer">
        <div class="wrapper">
          <div class="post">
            <header class="postHeader">
              <a class="edit-page-link button" href="https://github.com/lets-blade/lets-blade.github.io/edit/master/docs/component.md"
                target="_blank">
                编辑该页
              </a>
              <h1>组件托管</h1>
            </header>
            <article>
              <div>
                <p>
                  <p>Blade 中认为组件就是一种类型的 <code class="highlighter-rouge">Bean</code> 或者叫对象，框架内置了简单的 <code class="highlighter-rouge">IOC</code> 容器来帮你将他们托管起来。
这样用户在使用的时候就可以达到对象复用，不必无限的使用 <code class="highlighter-rouge">new</code> 关键词带来内存泄漏。那么我们在使用组件的
时候就要干2件事：1、创建一个组件 2、让 Blade 托管该组件</p>

<h2 id="核心特征">核心特征</h2>

<p>常驻内存，我们的组件被框架托管后实际上以单例的方式存储在缓存池中，用的时候取出来就可以了。</p>

<h2 id="组件类型">组件类型</h2>

<p>为了使用者更简单方面，在 Blade 中内置了这么几种组件类型，<code class="highlighter-rouge">BladeLoader</code>、<code class="highlighter-rouge">WebHook</code>、控制器。
那么我们来一起看看这几个分别都来干什么的？</p>

<p><strong>BladeLoader</strong></p>

<p>在一个 Web 开发中我们经常会使用到项目启动的时候加载一些 <strong>配置</strong> 或者干一些其他的事情，
在Blade中设计了一个接口 <code class="highlighter-rouge">BladeLoader</code>，你只需要创建一个自己的类实现这个接口即可完成初始化加载的动作。
比如我要在项目启动的时候设置模板引擎：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Order</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TemplateConfig</span> <span class="kd">implements</span> <span class="n">BladeLoader</span> <span class="o">{</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">load</span><span class="o">(</span><span class="n">Blade</span> <span class="n">blade</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">JetbrickTemplateEngine</span> <span class="n">templateEngine</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JetbrickTemplateEngine</span><span class="o">();</span>
        <span class="n">blade</span><span class="o">.</span><span class="na">templateEngine</span><span class="o">(</span><span class="n">templateEngine</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>那么这样的几行代码就帮助我们实现这样的功能，我们可以注意到这里实现了 <code class="highlighter-rouge">processor</code> 方法，
并且在该组件上面有 2 个注解，我们使用 <code class="highlighter-rouge">@Bean</code> 注解告诉框架这是一个组件，你将它帮我托管在
IOC 容器里吧。但是我有多个组件，我希望他们是按顺序执行的，所以又添加了一个 <code class="highlighter-rouge">@Order</code> 注解，
同时指定了这个组件的顺序是 <code class="highlighter-rouge">1</code>，那么框架在启动的时候会按照顺序执行所有组件的 <code class="highlighter-rouge">processor</code> 方法。</p>

<p><strong>WebHook</strong></p>

<p><code class="highlighter-rouge">WebHook</code> 是Blade中拦截一个路由的前、后可以做一些自定义的动作的接口，用户可以使用该接口完成一些登录拦截、日志记录、权限验证等操作。
在这个接口中有2个方法 <code class="highlighter-rouge">before</code> 和 <code class="highlighter-rouge">after</code>，并且 <code class="highlighter-rouge">after</code> 方法是一个 <strong>默认方法</strong> （这个概念在Java8中出现的），因为我们
发现绝大部分情况下使用不到 <code class="highlighter-rouge">after</code> 方法，那么使用者在实现该接口的时候只需要实现 <code class="highlighter-rouge">before</code> 即可。
下面我们写一个简单的例子可以体验一下：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyHook</span> <span class="kd">implements</span> <span class="n">WebHook</span> <span class="o">{</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">before</span><span class="o">(</span><span class="n">Signature</span> <span class="n">signature</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="na">request</span><span class="o">();</span>
        <span class="n">String</span>  <span class="n">uri</span>     <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">uri</span><span class="o">();</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"{}\t{}"</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">(),</span> <span class="n">uri</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>这里只是简单的记录了一下日志，我们可以看到一个 <code class="highlighter-rouge">WebHook</code>（钩子）方法中有一个 <code class="highlighter-rouge">Signature</code>。我们在这个类中打包了当前路由的上下文参数，
这些上下文参数包括: <code class="highlighter-rouge">Request</code>、<code class="highlighter-rouge">Response</code>、<code class="highlighter-rouge">Action</code> 以便于用户使用。</p>

<p><strong>控制器</strong></p>

<p>在 Blade 中标识一个类是控制器类非常简单，只需要在该类上面添加一个 <code class="highlighter-rouge">@Path</code> 注解即可，为了不使该类的配置过于复杂我们允许用户在该类上不出现 <code class="highlighter-rouge">@Bean</code>
 注解，其实是框架帮你做了。这样的好处是，使用 <code class="highlighter-rouge">@Path</code> 可以配置这个控制器的一些特性，比如 <code class="highlighter-rouge">namespace</code>、<code class="highlighter-rouge">restful</code> 参数等。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Path</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IndexController</span> <span class="o">{</span>
    
<span class="o">}</span>
</code></pre></div></div>

<p>这样这个 <code class="highlighter-rouge">IndexController</code> 就被 Blade 认为是一个控制器，在启动的时候将它托管起来，当你访问某个路由的时候会找到这个对象，得到复用。</p>

<p><strong>自定义组件</strong></p>

<p>很多时候我们有一些自己的业务，我们需要自定义实现一些 <code class="highlighter-rouge">Service</code> 这样的服务。在 Blade 中将概念简化了，认为一切组件都是一个 <code class="highlighter-rouge">Bean</code>。
那么我可以这样创建一个组件：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sayHi</span><span class="o">(){</span>
        <span class="k">return</span> <span class="s">"Hi blade"</span><span class="o">;</span>    
    <span class="o">}</span>
    
<span class="o">}</span>
</code></pre></div></div>

<p>当我想要在控制器中使用这个组件的时候也非常简单：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Path</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IndexController</span> <span class="o">{</span>
    
    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">UserService</span> <span class="n">userService</span><span class="o">;</span>
    
    <span class="nd">@GetRoute</span><span class="o">(</span><span class="s">"/sayhi"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sayHi</span><span class="o">(){</span>
        <span class="n">userService</span><span class="o">.</span><span class="na">sayHi</span><span class="o">();</span>
    <span class="o">}</span>
    
<span class="o">}</span>
</code></pre></div></div>

<p>使用 <code class="highlighter-rouge">@Inject</code> 注解注入一个我们定义好的组件，当然组件和组件的调用也是如此。</p>

<h2 id="内置组件">内置组件</h2>

<p>为了让开发者花更少的时候在开发核心业务上面，Blade 内置了一些 <strong>组件</strong> 供你使用。</p>

<ol>
  <li><code class="highlighter-rouge">DefaultExceptionHandler</code>：异常处理器，你如果有自定义的异常处理可以继承它。</li>
  <li><code class="highlighter-rouge">BasicAuthMiddleware</code>：Basic认证，如果用的到的话可以直接使用。</li>
  <li><code class="highlighter-rouge">CsrfMiddleware</code>：帮助你验证 <code class="highlighter-rouge">CSRF Token</code></li>
</ol>

                </p>
              </div>
            </article>
          </div>
          <!-- <div class="docs-prevnext">
            <a class="docs-next button" href="why-prettier.html">Why Prettier? →</a>
          </div> -->
        </div>
      </div>
    </div>
    <script id="twitter-wjs" sync src="https://platform.twitter.com/widgets.js"></script>
<script type="text/javascript" sync src="https://buttons.github.io/buttons.js"></script>

<footer class="footerSection nav-footer" id="footer">
    <section class="sitemap">
        <a href="/" class="nav-home">
            <img src="/static/icon.png" alt="Blade">
        </a>
        <div>
            <h5>Social Media</h5>
            <a href="https://twitter.com/PastelPeaks">@PastelPeaks on Twitter</a>
            <object type="image/svg+xml" data="https://img.shields.io/twitter/follow/PastelPeaks.svg?label=Follow+PastelPeaks&amp;style=social">
                <a href="https://twitter.com/intent/follow?screen_name=PastelPeaks">
                    <img alt="Follow us on Twitter" src="https://img.shields.io/twitter/follow/PastelPeaks.png?label=Follow+PastelPeaks&amp;style=social">
                </a>
            </object>
            <a href="https://www.instagram.com/PersonalSpaceGame/">@PersonalSpaceGame on Instagram</a>
        </div>
        <div>
            <img src="https://d1ggkj0laysj3f.cloudfront.net/wp-content/uploads/2018/10/29154938/GamerU-white-e1540850013969.png" 
            alt="University of Utah Logo"
            style="width: 25%;float: right;">
        </div>
    </section>
</footer>
  </div>
</body>

</html>