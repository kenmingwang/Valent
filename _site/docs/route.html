<!DOCTYPE html>
<html lang=" zh-CN ">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Personal Space Game</title>
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/static/icon.png">
    <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.12.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5e158f966719b70012374cbf&product=inline-follow-buttons" async="async"></script>
    <script type="text/javascript">
        hljs.initHighlightingOnLoad();
    </script>
</head>

<body class="sideNavVisible">
  <div class="fixedHeaderContainer">
  <div class="headerWrapper wrapper">
    <header>
      <a href="/">
        <img class="logo" src="/static/icon.png">
        <h2 class="headerTitle">Personal Space</h2>
      </a>
      <div class="navigationWrapper navigationSlider">
        <nav class="slidingNav">
          <ul class="nav-site nav-site-internal">
            <li>
              <a href="" target="">
                Common Issues
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </header>
  </div>
</div>
  <div class="navPusher">
    <div class="docMainWrapper wrapper">
      <div class="container docsNavContainer" id="docsNav">
        <nav class="toc">
          <div class="toggleNav">
            <section class="navWrapper wrapper">
              <div class="navBreadcrumb wrapper">
                <div class="navToggle" id="navToggler">
                  <i></i>
                </div>
                <h2>
                  <i>›</i>
                  <span>路由注册</span>
                </h2>
              </div>
              <div class="navGroups">

                

                
                <div class="navGroup navGroupActive">
                  <h3>介绍</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="why-blade.html">为什么是 Blade ?</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="blade-design.html">Blade 设计</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>快速入门</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="create-application.html">创建一个工程</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="create-route.html">创建路由</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="add-static-file.html">添加静态文件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="render-view.html">渲染视图</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>指南</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="installation.html">安装 Blade</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="component.html">组件托管</a>
                    </li>
                    
                    <li class="navListItem navItemActive">
                      <a class="navItem navItemActive" href="route.html">路由注册</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="route-context.html">路由上下文</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="request.html">HTTP 请求</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="response.html">HTTP 响应</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="webhook.html">WebHook</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="configuration.html">配置文件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="templates.html">模板视图</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="logging.html">日志输出</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="package-deploy.html">打包部署</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>进阶</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="exception.html">异常处理</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="schedule.html">定时任务</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="error-page.html">错误页面</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="listen-event.html">监听事件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="session-ext.html">Session 扩展</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="custom-middleware.html">自定义中间件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="cli-args.html">命令行参数</a>
                    </li>
                    
                  </ul>
                </div>
                
              </div>
            </section>
          </div>
          <script>
            var toggler = document.getElementById('navToggler');
            var nav = document.getElementById('docsNav');
            toggler.onclick = function () {
              nav.classList.toggle('docsSliderActive');
            };
          </script>
        </nav>
      </div>
      <div class="container mainContainer">
        <div class="wrapper">
          <div class="post">
            <header class="postHeader">
              <a class="edit-page-link button" href="https://github.com/lets-blade/lets-blade.github.io/edit/master/docs/route.md"
                target="_blank">
                编辑该页
              </a>
              <h1>路由注册</h1>
            </header>
            <article>
              <div>
                <p>
                  <p>路由是 Blade 中的核心，路由是一个 Http 请求处理的最小的最小单元，我们需要在程序中创建好 URL 和路由的映射关系。
在Blade中注册一个路由有2种方式，在下面我们详细讲解。</p>

<h2 id="路由规则">路由规则</h2>

<p>在 Blade 的路由规则不是特别复杂，我们追求简洁与优雅，不希望把事情做的更麻烦。
所以路由规则分为这么几种：</p>

<ol>
  <li>静态路由</li>
  <li>资源文件路由</li>
  <li>Restful路由</li>
</ol>

<blockquote>
  <p><strong>静态路由</strong>是最容易理解的，也就是我写了 <code class="highlighter-rouge">/hello</code> 那么当我访问 http://127.0.0.1:9000/hello
 就会匹配到该路由，匹配关系是一一对应的。</p>
</blockquote>

<blockquote>
  <p><strong>资源文件路由</strong>：Blade 内置了 <code class="highlighter-rouge">static</code>、<code class="highlighter-rouge">upload</code> 文件夹下的文件都是静态资源，同时支持用户自定义。
所以当你访问诸如 <code class="highlighter-rouge">/static/a.css</code> 这样的路由就会匹配到静态资源文件。</p>
</blockquote>

<blockquote>
  <p>当我们注册一个 <code class="highlighter-rouge">/users/:uid</code> 这样的路由规则的时候它是一个 <code class="highlighter-rouge">Restful</code> 风格的URL，会匹配到相应的路由实现，
当然你可以使用多个参数。</p>
</blockquote>

<h2 id="blade-注册">Blade 注册</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Blade</span><span class="o">.</span><span class="na">of</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">text</span><span class="o">(</span><span class="s">"Hello World"</span><span class="o">));</span>
<span class="n">Blade</span><span class="o">.</span><span class="na">of</span><span class="o">().</span><span class="na">post</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">text</span><span class="o">(</span><span class="s">"Hello World"</span><span class="o">));</span>
<span class="n">Blade</span><span class="o">.</span><span class="na">of</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">text</span><span class="o">(</span><span class="s">"Hello World"</span><span class="o">));</span>
<span class="n">Blade</span><span class="o">.</span><span class="na">of</span><span class="o">().</span><span class="na">delete</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">text</span><span class="o">(</span><span class="s">"Hello World"</span><span class="o">));</span>
</code></pre></div></div>

<p>你在刚认识 Blade 的时候这是你见到的一段代码，这看起来非常简单，
但是是有局限性的，只有非常简单的 Web 应用你才会这么做。
因为代码的组织构成都在一个类中，并且在 <code class="highlighter-rouge">main</code> 函数内部，
所以注定这样的一个程序必然是非常简单的，比如实现一个静态站点、文件下载服务器等。</p>

<p>我们来看看 <code class="highlighter-rouge">Blade.get</code> 这个方法，它接收2个参数，第一个是路由匹配的 <code class="highlighter-rouge">URL</code>，
第二个参数用于处理请求（<code class="highlighter-rouge">RouteHandler</code>接口），因为我们使用Java8所以写法看起来比较简洁。</p>

<h2 id="控制器注册">控制器注册</h2>

<p>大部分时候我们会使用 <code class="highlighter-rouge">类</code> 来封装一些相同功能的路由，我们将它称之为控制器。
Blade 在启动的时候会扫描控制器中的路由。</p>

<p><strong>1. 创建控制器</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Path</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IndexController</span> <span class="o">{</span>
    
<span class="o">}</span>
</code></pre></div></div>

<p>我们来看看这个 <code class="highlighter-rouge">@Path</code> 注解，它有几个常用的配置参数</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nd">@interface</span> <span class="n">Path</span> <span class="o">{</span>
    
    <span class="cm">/**
     * @return namespace
     */</span>
    <span class="n">String</span> <span class="nf">value</span><span class="o">()</span> <span class="k">default</span> <span class="s">"/"</span><span class="o">;</span>

    <span class="cm">/**
     * @return route suffix
     */</span>
    <span class="n">String</span> <span class="nf">suffix</span><span class="o">()</span> <span class="k">default</span> <span class="s">""</span><span class="o">;</span>

    <span class="cm">/**
     * @return is restful api
     */</span>
    <span class="kt">boolean</span> <span class="nf">restful</span><span class="o">()</span> <span class="k">default</span> <span class="kc">false</span><span class="o">;</span>

    <span class="cm">/**
     * @return path description
     */</span>
    <span class="n">String</span> <span class="nf">description</span><span class="o">()</span> <span class="k">default</span> <span class="s">""</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>从这里可以看出，我们使用 <code class="highlighter-rouge">@Path</code> 注解的时候注册了一个 <code class="highlighter-rouge">namespace</code> 为 <code class="highlighter-rouge">/</code> 的控制器，在该控制器下的路由规则都会和 <code class="highlighter-rouge">/</code> 进行拼接。
你可以使用 <code class="highlighter-rouge">suffix</code> 来设置路由的后缀，比如有时候我们需要所有后缀都是 <code class="highlighter-rouge">.html</code>。还有一种需求就是我这个控制器是做 <code class="highlighter-rouge">API</code> 给别人
调用的，那么我们可以设置 <code class="highlighter-rouge">restful</code> 选项为 <code class="highlighter-rouge">true</code>，这样控制器中的所有路由都会返回 <code class="highlighter-rouge">JSON</code> 输出了。</p>

<p><strong>2. 创建路由</strong></p>

<p>在控制器中创建路由的方式分 2 种，直接创建方法相关的路由、自定义创建。
共有这么几种注解帮你完成：<code class="highlighter-rouge">GetRoute</code>、<code class="highlighter-rouge">PostRoute</code>、<code class="highlighter-rouge">PutRoute</code>、<code class="highlighter-rouge">DeleteRoute</code>、<code class="highlighter-rouge">Route</code></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetRoute</span><span class="o">(</span><span class="s">"/home"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(){</span>
    <span class="k">return</span> <span class="s">"index.html"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>聪明的同学已经看出来，我明确了路由的时候使用 <code class="highlighter-rouge">HttpMethod+Route</code> 这种方式更简便，当然也可以使用 <code class="highlighter-rouge">@Route</code> 进行自定义</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Route</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/home"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(){</span>
    <span class="k">return</span> <span class="s">"index.html"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>当你不指定 <code class="highlighter-rouge">method</code> 的时候它将接收任意Http方法的请求。</p>

<h2 id="参数注入">参数注入</h2>

<p>为了加速开发，Blade 在路由上做了一些 <strong>手脚</strong>，让你更快的获取参数。</p>

<p><strong>1. 获取Form表单参数</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetRoute</span><span class="o">(</span><span class="s">"/home"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">home</span><span class="o">(</span><span class="nd">@Param</span> <span class="n">String</span> <span class="n">name</span><span class="o">){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"name: "</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"index.html"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>2. 获取Restful参数</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetRoute</span><span class="o">(</span><span class="s">"/users/:uid"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">users</span><span class="o">(</span><span class="nd">@PathParam</span> <span class="n">Integer</span> <span class="n">uid</span><span class="o">){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"uid: "</span> <span class="o">+</span> <span class="n">uid</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>3. 获取上传文件参数</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostRoute</span><span class="o">(</span><span class="s">"/upload"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">upload</span><span class="o">(</span><span class="nd">@MultipartParam</span> <span class="n">FileItem</span> <span class="n">fileItem</span><span class="o">){</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">fileItem</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
    <span class="c1">// Save the temporary file to the specified path</span>
    <span class="n">Files</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">filePath</span><span class="o">),</span> <span class="n">data</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>4. 获取Header参数</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetRoute</span><span class="o">(</span><span class="s">"/header"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">users</span><span class="o">(</span><span class="nd">@HeaderParam</span> <span class="n">String</span> <span class="n">Referer</span><span class="o">){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Referer: "</span> <span class="o">+</span> <span class="n">Referer</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>5. 获取Cookie参数</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetRoute</span><span class="o">(</span><span class="s">"/cookie"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">users</span><span class="o">(</span><span class="nd">@CookieParam</span> <span class="n">String</span> <span class="n">uid</span><span class="o">){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"uid: "</span> <span class="o">+</span> <span class="n">uid</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>6. 获取Body参数</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetRoute</span><span class="o">(</span><span class="s">"/bodyParam"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">users</span><span class="o">(</span><span class="nd">@BodyParam</span> <span class="n">PayRequest</span> <span class="n">payRequest</span><span class="o">){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"payRequest: "</span> <span class="o">+</span> <span class="n">JsonKit</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">payRequest</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>7. 获取对象参数</strong></p>

<p>获取对象参数有几种约定，默认情况你可以将 <code class="highlighter-rouge">form</code> 表单的元素 <code class="highlighter-rouge">name</code> 写成和类变量一一对应这个就可以了。
你也可以使用 Blade 的约定来传递，给本次传参定义一个名字，像 <code class="highlighter-rouge">person</code>，那么Form表单中定义为 <code class="highlighter-rouge">&lt;input name="person[age]"/&gt;</code> 
这样的格式即可。下面是2个例子：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetRoute</span><span class="o">(</span><span class="s">"/savePerson"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">users</span><span class="o">(</span><span class="nd">@Param</span> <span class="n">Person</span> <span class="n">person</span><span class="o">){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"person: "</span> <span class="o">+</span> <span class="n">person</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>这个请求中一般 Form 表单是这样的：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"age"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<hr />

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetRoute</span><span class="o">(</span><span class="s">"/savePerson"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">users</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"person"</span><span class="o">)</span> <span class="n">Person</span> <span class="n">person</span><span class="o">){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"person: "</span> <span class="o">+</span> <span class="n">person</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>这个请求中一般 Form 表单是这样的：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"person[age]"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"person[name]"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

                </p>
              </div>
            </article>
          </div>
          <!-- <div class="docs-prevnext">
            <a class="docs-next button" href="why-prettier.html">Why Prettier? →</a>
          </div> -->
        </div>
      </div>
    </div>
    <script id="twitter-wjs" sync src="https://platform.twitter.com/widgets.js"></script>
<script type="text/javascript" sync src="https://buttons.github.io/buttons.js"></script>

<footer class="footerSection nav-footer" id="footer">
    <section class="sitemap">
        <a href="/" class="nav-home">
            <img src="/static/icon.png" alt="Blade">
        </a>
        <div>
            <h5>Social Media</h5>
            <a href="https://twitter.com/PastelPeaks">@PastelPeaks on Twitter</a>
            <object type="image/svg+xml" data="https://img.shields.io/twitter/follow/PastelPeaks.svg?label=Follow+PastelPeaks&amp;style=social">
                <a href="https://twitter.com/intent/follow?screen_name=PastelPeaks">
                    <img alt="Follow us on Twitter" src="https://img.shields.io/twitter/follow/PastelPeaks.png?label=Follow+PastelPeaks&amp;style=social">
                </a>
            </object>
            <a href="https://www.instagram.com/PersonalSpaceGame/">@PersonalSpaceGame on Instagram</a>
        </div>
        <div>
            <img src="https://d1ggkj0laysj3f.cloudfront.net/wp-content/uploads/2018/10/29154938/GamerU-white-e1540850013969.png" 
            alt="University of Utah Logo"
            style="width: 25%;float: right;">
        </div>
    </section>
</footer>
  </div>
</body>

</html>