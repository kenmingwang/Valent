<!DOCTYPE html>
<html lang=" zh-CN ">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Personal Space Game</title>
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/static/icon.png">
    <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.12.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript"
        src="https://platform-api.sharethis.com/js/sharethis.js#property=5e158f966719b70012374cbf&product=inline-follow-buttons"
        async="async"></script>
    <script type="text/javascript">
        hljs.initHighlightingOnLoad();
    </script>
    <!-- Place your kit's code here -->
    <script src="https://kit.fontawesome.com/db17860b98.js" crossorigin="anonymous"></script>

</head>

<body class="sideNavVisible">
  <div class="fixedHeaderContainer">
  <div class="headerWrapper wrapper">
    <header>
      <a href="/">
        <img class="logo" src="/static/icon.png">
        <h2 class="headerTitle">Personal Space</h2>
      </a>
      <div class="navigationWrapper navigationSlider">
        <nav class="slidingNav">
          <ul class="nav-site nav-site-internal">
            <li>
              <!-- <a href="" target="">
                Common Issues
              </a> -->
            </li>
          </ul>
        </nav>
      </div>
    </header>
  </div>
</div>
  <div class="navPusher">
    <div class="docMainWrapper wrapper">
      <div class="container docsNavContainer" id="docsNav">
        <nav class="toc">
          <div class="toggleNav">
            <section class="navWrapper wrapper">
              <div class="navBreadcrumb wrapper">
                <div class="navToggle" id="navToggler">
                  <i></i>
                </div>
                <h2>
                  <i>›</i>
                  <span>HTTP 请求</span>
                </h2>
              </div>
              <div class="navGroups">

                

                
                <div class="navGroup navGroupActive">
                  <h3>介绍</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="why-blade.html">为什么是 Blade ?</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="blade-design.html">Blade 设计</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>快速入门</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="create-application.html">创建一个工程</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="create-route.html">创建路由</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="add-static-file.html">添加静态文件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="render-view.html">渲染视图</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>指南</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="installation.html">安装 Blade</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="component.html">组件托管</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="route.html">路由注册</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="route-context.html">路由上下文</a>
                    </li>
                    
                    <li class="navListItem navItemActive">
                      <a class="navItem navItemActive" href="request.html">HTTP 请求</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="response.html">HTTP 响应</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="webhook.html">WebHook</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="configuration.html">配置文件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="templates.html">模板视图</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="logging.html">日志输出</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="package-deploy.html">打包部署</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>进阶</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="exception.html">异常处理</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="schedule.html">定时任务</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="error-page.html">错误页面</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="listen-event.html">监听事件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="session-ext.html">Session 扩展</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="custom-middleware.html">自定义中间件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="cli-args.html">命令行参数</a>
                    </li>
                    
                  </ul>
                </div>
                
              </div>
            </section>
          </div>
          <script>
            var toggler = document.getElementById('navToggler');
            var nav = document.getElementById('docsNav');
            toggler.onclick = function () {
              nav.classList.toggle('docsSliderActive');
            };
          </script>
        </nav>
      </div>
      <div class="container mainContainer">
        <div class="wrapper">
          <div class="post">
            <header class="postHeader">
              <a class="edit-page-link button" href="https://github.com/lets-blade/lets-blade.github.io/edit/master/docs/request.md"
                target="_blank">
                编辑该页
              </a>
              <h1>HTTP 请求</h1>
            </header>
            <article>
              <div>
                <p>
                  <p>Blade 支持注解的方式或者使用 <code class="highlighter-rouge">Request</code> 对象获取请求信息。</p>

<h2 id="表单参数">表单参数</h2>

<p>先看看 <code class="highlighter-rouge">Request</code> 提供的操作表单参数的API</p>

<ul>
  <li><code class="highlighter-rouge">Optional&lt;String&gt; query(String name)</code></li>
  <li><code class="highlighter-rouge">Optional&lt;Integer&gt; queryInt(String name)</code></li>
  <li><code class="highlighter-rouge">Optional&lt;Long&gt; queryLong(String name)</code></li>
  <li><code class="highlighter-rouge">Optional&lt;Double&gt; queryDouble(String name)</code></li>
  <li><code class="highlighter-rouge">String query(String name, String defaultValue)</code></li>
  <li><code class="highlighter-rouge">int queryInt(String name, int defaultValue)</code></li>
  <li><code class="highlighter-rouge">long queryLong(String name, long defaultValue)</code></li>
  <li><code class="highlighter-rouge">double queryDouble(String name, double defaultValue)</code></li>
</ul>

<p>这几组API非常的清晰明了，因为使用了 Java8，有一组里面用了 <code class="highlighter-rouge">Optional</code> 的写法，为了让大家拿不到值的时候进行判断或其他处理，其实和带 <code class="highlighter-rouge">defaultValue</code> 的API是差不多的，因为 <code class="highlighter-rouge">Optional</code> 提供一个 <code class="highlighter-rouge">orElse</code> 方法让你设置默认值。怎么用呢？其实只要API设计的到位大家十有八九都可以猜到怎么用的，我能告诉你的是这组 API 获取的是 <code class="highlighter-rouge">Form</code> 表单的参数。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="se">\</span>
  <span class="nt">-X</span> POST <span class="se">\</span>
  http://localhost:9000/save <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'username=Jack'</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostRoute</span><span class="o">(</span><span class="s">"/save"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">formParams</span><span class="o">(</span><span class="nd">@Param</span> <span class="n">String</span> <span class="n">username</span><span class="o">){</span>

<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostRoute</span><span class="o">(</span><span class="s">"/save"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">formParams</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">){</span>
    <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="s">"默认值"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>获取 <code class="highlighter-rouge">Integer</code> 数据: <code class="highlighter-rouge">request.queryInt("xxx")</code></li>
  <li>获取 <code class="highlighter-rouge">Long</code> 数据: <code class="highlighter-rouge">request.queryLong("xxx")</code></li>
  <li>获取 <code class="highlighter-rouge">Double</code> 数据: <code class="highlighter-rouge">request.queryDouble("xxx")</code></li>
</ul>

<h2 id="json数据">JSON数据</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="se">\</span>
  <span class="nt">-X</span> POST <span class="se">\</span>
  http://localhost:9000/users <span class="se">\</span>
  <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
  <span class="nt">-d</span> <span class="s1">'{"name":"biezhi","email":"biezhi.me@gmail.com"}'</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
    <span class="c1">// getter setter 省略</span>
<span class="o">}</span>

<span class="nd">@PostRoute</span><span class="o">(</span><span class="s">"/users"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">bodyParams</span><span class="o">(</span><span class="nd">@BodyParam</span> <span class="n">User</span> <span class="n">user</span><span class="o">){</span>
    
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostRoute</span><span class="o">(</span><span class="s">"/users"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">bodyParams</span><span class="o">(</span><span class="n">Request</span> <span class="n">request</span><span class="o">){</span>
    <span class="n">String</span> <span class="n">bodyString</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">bodyToString</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="restful-参数">Restful 参数</h2>

<p>我们经常也会用到 REST 接口，一般它的URL形如：http://www.exmaple.com/users/128</p>

<p>这时候我们在 Blade 中定义的路由 Path 是 <code class="highlighter-rouge">/users/:id</code>，如何获取这个 id 呢，下面的API可以帮到你</p>

<ul>
  <li><code class="highlighter-rouge">String pathString(String name)</code></li>
  <li><code class="highlighter-rouge">String pathInt(String name)</code></li>
  <li><code class="highlighter-rouge">String pathLong(String name)</code></li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Integer</span> <span class="n">userId</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">pathInt</span><span class="o">(</span><span class="s">"id"</span><span class="o">);</span>
</code></pre></div></div>

<p>这样就可以获取到 <code class="highlighter-rouge">userId</code>，其他变量的获取方式相应你闭着眼睛都可以猜到。</p>

<p>也可以使用注解的方式</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetRoute</span><span class="o">(</span><span class="s">"/user/:uid"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">user</span><span class="o">(</span><span class="nd">@PathParam</span> <span class="n">Integer</span> <span class="n">uid</span><span class="o">){</span>

<span class="o">}</span>
</code></pre></div></div>

<h2 id="数据绑定">数据绑定</h2>

<p>Blade 支持将参数绑定到某个模型对象上，你可以像这样使用</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
    <span class="c1">// getter setter 省略</span>
<span class="o">}</span>

<span class="nd">@PostRoute</span><span class="o">(</span><span class="s">"/users"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">bodyParams</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">){</span>
    
<span class="o">}</span>
</code></pre></div></div>

<p>此时接收的表单参数或者 <code class="highlighter-rouge">Request Body</code> 的 <code class="highlighter-rouge">JSON</code> 参数会被自动映射为一个 <code class="highlighter-rouge">User</code> 对象。</p>

<h2 id="自定义绑定">自定义绑定</h2>

<p>如果你想自定义的绑定数据，比如像 <code class="highlighter-rouge">ruby</code> 那样在 <code class="highlighter-rouge">input</code> 文本框中指定某类名称才被匹配，
可以像这样：</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"ie=edge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Document<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;form&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"user[name]"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"user[age]"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostRoute</span><span class="o">(</span><span class="s">"/save"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">customBind</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"user"</span><span class="o">)</span> <span class="n">User</span> <span class="n">user</span><span class="o">){</span>

<span class="o">}</span>
</code></pre></div></div>

<h2 id="读取头信息">读取头信息</h2>

<p>依然看API，虽然我一直在重复看 API，因为框架编写的 API 就是为了给用户提供便捷。</p>

<ul>
  <li><code class="highlighter-rouge">Map&lt;String, String&gt; headers()</code></li>
  <li><code class="highlighter-rouge">String header(String name)</code></li>
  <li><code class="highlighter-rouge">String header(String name, String defaultValue)</code></li>
  <li><code class="highlighter-rouge">boolean isIE()</code></li>
  <li><code class="highlighter-rouge">boolean isAjax()</code></li>
  <li><code class="highlighter-rouge">String contentType()</code></li>
  <li><code class="highlighter-rouge">String userAgent()</code></li>
</ul>

<p>上面的 API 除了给出获取 <code class="highlighter-rouge">header</code> 的方法，也提供了常用的几个附件方法，用于获取是否是IE浏览器、是否是Ajax请求、ContentType 以及 UserAgent。</p>

<h2 id="读取-cookie">读取 Cookie</h2>

<ul>
  <li><code class="highlighter-rouge">Map&lt;String, String&gt; cookies()</code></li>
  <li><code class="highlighter-rouge">Optional&lt;Cookie&gt; cookieRaw(String name)</code></li>
  <li><code class="highlighter-rouge">String cookie(String name, String defaultValue)</code></li>
</ul>

<p>这里的几个方法介绍一下，第一个是获取所有的 Cookie，map 的 key 是 cookie名，value 是 cookie值；第二个方法根据名称获取 cookie，这里可以获取到 cookie 的详细信息，包括 path、有效期等；最后一个方法根据名称获取 cookie，获取不到则设置一个默认值。</p>

<h2 id="设置数据">设置数据</h2>

<p>很多时候我们都会用模板引擎，即便你没用过至少也知道JSP，我们会在 Request 作用域中设置一些数据，然后在模板中获取。在 Blade 中也是如此，API也很简单。</p>

<ul>
  <li><code class="highlighter-rouge">attribute(String name, Object value)</code></li>
  <li><code class="highlighter-rouge">T attribute(String name)</code></li>
</ul>

<p>这里第一个方法是像 Request 域设置一个数据，第二个方法从 Request 域获取一个数据，至于这里设置的数据在前端如何使用取决于你的模板引擎是哪个，根据其语法而来，比如默认的模板引擎非常简单，我们举个例子：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">request</span><span class="o">.</span><span class="na">attribute</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"blade2.0"</span><span class="o">);</span>
</code></pre></div></div>

<p>在我们的模板中(存储在 <code class="highlighter-rouge">/resources/templates</code> 之下的视图文件)</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>这是 ${name}<span class="nt">&lt;/h1&gt;</span>
</code></pre></div></div>

<h2 id="操作-session">操作 Session</h2>

<ul>
  <li><code class="highlighter-rouge">request.session()</code></li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">session</span><span class="o">();</span>
<span class="c1">// 写入 session</span>
<span class="n">session</span><span class="o">.</span><span class="na">attribute</span><span class="o">(</span><span class="s">"LOGIN_USER"</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>

<span class="c1">// 读取 session</span>
<span class="n">String</span> <span class="n">hello</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">attribute</span><span class="o">(</span><span class="s">"hello"</span><span class="o">);</span>
</code></pre></div></div>

                </p>
              </div>
            </article>
          </div>
          <!-- <div class="docs-prevnext">
            <a class="docs-next button" href="why-prettier.html">Why Prettier? →</a>
          </div> -->
        </div>
      </div>
    </div>
    <script id="twitter-wjs" sync src="https://platform.twitter.com/widgets.js"></script>
<script type="text/javascript" sync src="https://buttons.github.io/buttons.js"></script>

<footer class="footerSection nav-footer" id="footer">
    <section class="sitemap">
        <a href="/" class="nav-home">
            <img src="/static/icon.png" alt="Blade">
        </a>
        <div>
            <h5>Social Media</h5>
            <a href="https://twitter.com/PastelPeaks">@PastelPeaks on Twitter</a>
            <object type="image/svg+xml" data="https://img.shields.io/twitter/follow/PastelPeaks.svg?label=Follow+PastelPeaks&amp;style=social">
                <a href="https://twitter.com/intent/follow?screen_name=PastelPeaks">
                    <img alt="Follow us on Twitter" src="https://img.shields.io/twitter/follow/PastelPeaks.png?label=Follow+PastelPeaks&amp;style=social">
                </a>
            </object>
            <a href="https://www.instagram.com/PersonalSpaceGame/">@PersonalSpaceGame on Instagram</a>
        </div>
        <div>
            <img id="ulogo_pc" src="https://d1ggkj0laysj3f.cloudfront.net/wp-content/uploads/2018/10/29154938/GamerU-white-e1540850013969.png" 
            alt="University of Utah Logo"
            style="width: 25%; float: right;">

            <img id="ulogo_mobile" src="https://d1ggkj0laysj3f.cloudfront.net/wp-content/uploads/2018/10/29154938/GamerU-white-e1540850013969.png" 
            alt="University of Utah Logo"
            style="width: 25%;">
        </div>
    </section>
</footer>

<script>
    function _isMobile() {
        // if we want a more complete list use this: http://detectmobilebrowsers.com/
        // str.test() is more efficent than str.match()
        // remember str.test is case sensitive
        var isMobile = (/iphone|ipod|android|ie|blackberry|fennec/).test
            (navigator.userAgent.toLowerCase());
        return isMobile;
    }

    if (_isMobile()) {
        document.getElementById("ulogo_pc").style.display = "none";
    }
    else {
        document.getElementById("ulogo_mobile").style.display = "none";
    }

</script>
  </div>
</body>

</html>