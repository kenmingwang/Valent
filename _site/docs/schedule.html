<!DOCTYPE html>
<html lang=" zh-CN ">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Personal Space Game</title>
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/static/icon.png">
    <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.12.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5e158f966719b70012374cbf&product=inline-follow-buttons" async="async"></script>
    <script type="text/javascript">
        hljs.initHighlightingOnLoad();
    </script>
</head>

<body class="sideNavVisible">
  <div class="fixedHeaderContainer">
  <div class="headerWrapper wrapper">
    <header>
      <a href="/">
        <img class="logo" src="/static/icon.png">
        <h2 class="headerTitle">Personal Space</h2>
      </a>
      <div class="navigationWrapper navigationSlider">
        <nav class="slidingNav">
          <ul class="nav-site nav-site-internal">
            <li>
              <a href="" target="">
                Common Issues
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </header>
  </div>
</div>
  <div class="navPusher">
    <div class="docMainWrapper wrapper">
      <div class="container docsNavContainer" id="docsNav">
        <nav class="toc">
          <div class="toggleNav">
            <section class="navWrapper wrapper">
              <div class="navBreadcrumb wrapper">
                <div class="navToggle" id="navToggler">
                  <i></i>
                </div>
                <h2>
                  <i>›</i>
                  <span>定时任务</span>
                </h2>
              </div>
              <div class="navGroups">

                

                
                <div class="navGroup navGroupActive">
                  <h3>介绍</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="why-blade.html">为什么是 Blade ?</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="blade-design.html">Blade 设计</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>快速入门</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="create-application.html">创建一个工程</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="create-route.html">创建路由</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="add-static-file.html">添加静态文件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="render-view.html">渲染视图</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>指南</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="installation.html">安装 Blade</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="component.html">组件托管</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="route.html">路由注册</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="route-context.html">路由上下文</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="request.html">HTTP 请求</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="response.html">HTTP 响应</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="webhook.html">WebHook</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="configuration.html">配置文件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="templates.html">模板视图</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="logging.html">日志输出</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="package-deploy.html">打包部署</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>进阶</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="exception.html">异常处理</a>
                    </li>
                    
                    <li class="navListItem navItemActive">
                      <a class="navItem navItemActive" href="schedule.html">定时任务</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="error-page.html">错误页面</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="listen-event.html">监听事件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="session-ext.html">Session 扩展</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="custom-middleware.html">自定义中间件</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="cli-args.html">命令行参数</a>
                    </li>
                    
                  </ul>
                </div>
                
              </div>
            </section>
          </div>
          <script>
            var toggler = document.getElementById('navToggler');
            var nav = document.getElementById('docsNav');
            toggler.onclick = function () {
              nav.classList.toggle('docsSliderActive');
            };
          </script>
        </nav>
      </div>
      <div class="container mainContainer">
        <div class="wrapper">
          <div class="post">
            <header class="postHeader">
              <a class="edit-page-link button" href="https://github.com/lets-blade/lets-blade.github.io/edit/master/docs/schedule.md"
                target="_blank">
                编辑该页
              </a>
              <h1>定时任务</h1>
            </header>
            <article>
              <div>
                <p>
                  <p>在 Blade <code class="highlighter-rouge">2.0.8</code> 版本之后加入了 cron 表达式来完成定时执行任务的需求。
你只需要在处理任务的方法上添加一个 <code class="highlighter-rouge">@Schedule</code> 注解，然后编写 cron 表达式即可。</p>

<p>Blade 的任务系统提供你创建、停止、获取任务列表的 API。</p>

<h2 id="创建一个任务">创建一个任务</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleTask</span> <span class="o">{</span>

   <span class="nd">@Schedule</span><span class="o">(</span><span class="n">cron</span> <span class="o">=</span> <span class="s">"* * * * * ?"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">syncRelate</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"执行一次"</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>这样就可以创建一个每秒钟执行一次的定时任务了。此时创建的定时任务名称是 <code class="highlighter-rouge">task-0</code>，
当你没有指定一个任务名称的时候，系统会按照数字顺序从 <code class="highlighter-rouge">0</code> 开始为他们命名，如果你想动态的
关闭他们，一定要在 <code class="highlighter-rouge">@Schedule</code> 注解上加入 <code class="highlighter-rouge">name</code> 来命名它，像这样。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleTask</span> <span class="o">{</span>

   <span class="nd">@Schedule</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"task1"</span><span class="o">,</span> <span class="n">cron</span> <span class="o">=</span> <span class="s">"* * * * * ?"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">syncRelate</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"执行一次"</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<h2 id="taskmanager">TaskManager</h2>

<p>可以通过调用 <code class="highlighter-rouge">TaskManager</code> 的静态方法来管理任务，下面是 <code class="highlighter-rouge">TaskManager</code> 的API。</p>

<ul>
  <li><code class="highlighter-rouge">getTask(name)</code>：根据任务名获取一个任务。</li>
  <li><code class="highlighter-rouge">getTasks()</code>：获取系统所有任务</li>
  <li><code class="highlighter-rouge">stopTask(name)</code>：根据任务名停止一个正在运行的任务</li>
</ul>

<p>关闭任务的方法是在 <code class="highlighter-rouge">Task</code> 内部实现的，每一个任务都会有一个上下文，在前面的创建任务中你看到
每个方法都是没有参数的，Blade 支持你传入一个 <code class="highlighter-rouge">TaskContext</code> 类型的参数来操作当前的任务
（可能大多数情况用不到）。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="n">AtomicInteger</span> <span class="n">run1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">();</span>

<span class="nd">@Schedule</span><span class="o">(</span><span class="n">cron</span> <span class="o">=</span> <span class="s">"* * * * * ?"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run1</span><span class="o">(</span><span class="n">TaskContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">run1</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">==</span> <span class="mi">5</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">context</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">run1</span><span class="o">.</span><span class="na">getAndIncrement</span><span class="o">();</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">()</span> <span class="o">+</span> <span class="s">": Hello task1. "</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<p>像这样可以在某个条件触发的时候关闭一个任务。</p>

<h2 id="常用的-cron-表达式">常用的 Cron 表达式</h2>

<ul>
  <li><code class="highlighter-rouge">*/5 * * * * ?</code>: 每隔5秒执行一次</li>
  <li><code class="highlighter-rouge">0 */1 * * * ?</code>: 每隔1分钟执行一次</li>
  <li><code class="highlighter-rouge">0 0/5 * * * ?</code>: 每隔5分钟执行一次</li>
  <li><code class="highlighter-rouge">0 0 23 * * ?</code>: 每天23点执行一次</li>
  <li><code class="highlighter-rouge">0 0 1 * * ?</code>: 每天凌晨1点执行一次</li>
  <li><code class="highlighter-rouge">0 0 1 1 * ?</code>: 每月1号凌晨1点执行一次</li>
  <li><code class="highlighter-rouge">0 0 23 L * ?</code>: 每月最后一天23点执行一次</li>
  <li><code class="highlighter-rouge">0 0 1 ? * L</code>: 每周星期天凌晨1点实行一次</li>
  <li><code class="highlighter-rouge">0 26,29,33 * * * ?</code>: 在26分、29分、33分执行一次</li>
  <li><code class="highlighter-rouge">0 0 0,13,18,21 * * ?</code>: 每天的0点、13点、18点、21点都执行一次</li>
  <li><code class="highlighter-rouge">0 0 12 * * ?</code>: 每天中午12点触发</li>
  <li><code class="highlighter-rouge">0 15 10 ? * *</code>: 每天上午10:15触发</li>
  <li><code class="highlighter-rouge">0 15 10 * * ?</code>: 每天上午10:15触发</li>
  <li><code class="highlighter-rouge">0 15 10 * * ? *</code>: 每天上午10:15触发</li>
  <li><code class="highlighter-rouge">0 15 10 * * ? 2005</code>: 2005年的每天上午10:15触发</li>
  <li><code class="highlighter-rouge">0 * 14 * * ?</code>: 在每天下午2点到下午2:59期间的每1分钟触发</li>
  <li><code class="highlighter-rouge">0 0/5 14 * * ?</code>: 在每天下午2点到下午2:55期间的每5分钟触发</li>
  <li><code class="highlighter-rouge">0 0/5 14,18 * * ?</code>: 在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发</li>
  <li><code class="highlighter-rouge">0 0-5 14 * * ?</code>: 在每天下午2点到下午2:05期间的每1分钟触发</li>
  <li><code class="highlighter-rouge">0 10,44 14 ? 3 WED</code>: 每年三月的星期三的下午2:10和2:44触发</li>
  <li><code class="highlighter-rouge">0 15 10 ? * MON-FRI</code>: 周一至周五的上午10:15触发</li>
  <li><code class="highlighter-rouge">0 15 10 15 * ?</code>: 每月15日上午10:15触发</li>
  <li><code class="highlighter-rouge">0 15 10 L * ?</code>: 每月最后一日的上午10:15触发</li>
  <li><code class="highlighter-rouge">0 15 10 ? * 6L</code>: 每月的最后一个星期五上午10:15触发</li>
  <li><code class="highlighter-rouge">0 15 10 ? * 6L 2002-2005</code>: 2002年至2005年的每月的最后一个星期五上午10:15触发</li>
  <li><code class="highlighter-rouge">0 15 10 ? * 6#3</code>: 每月的第三个星期五上午10:15触发</li>
  <li><code class="highlighter-rouge">0 15 10 ? * 6#3</code>: 每月的第三个星期五上午10:15触发</li>
</ul>

<p><a href="http://cron.qqe2.com/">在线Cron表达式生成器</a></p>

                </p>
              </div>
            </article>
          </div>
          <!-- <div class="docs-prevnext">
            <a class="docs-next button" href="why-prettier.html">Why Prettier? →</a>
          </div> -->
        </div>
      </div>
    </div>
    <script id="twitter-wjs" sync src="https://platform.twitter.com/widgets.js"></script>
<script type="text/javascript" sync src="https://buttons.github.io/buttons.js"></script>

<footer class="footerSection nav-footer" id="footer">
    <section class="sitemap">
        <a href="/" class="nav-home">
            <img src="/static/icon.png" alt="Blade">
        </a>
        <div>
            <h5>Social Media</h5>
            <a href="https://twitter.com/PastelPeaks">@PastelPeaks on Twitter</a>
            <object type="image/svg+xml" data="https://img.shields.io/twitter/follow/PastelPeaks.svg?label=Follow+PastelPeaks&amp;style=social">
                <a href="https://twitter.com/intent/follow?screen_name=PastelPeaks">
                    <img alt="Follow us on Twitter" src="https://img.shields.io/twitter/follow/PastelPeaks.png?label=Follow+PastelPeaks&amp;style=social">
                </a>
            </object>
            <a href="https://www.instagram.com/PersonalSpaceGame/">@PersonalSpaceGame on Instagram</a>
        </div>
        <div>
            <img src="https://d1ggkj0laysj3f.cloudfront.net/wp-content/uploads/2018/10/29154938/GamerU-white-e1540850013969.png" 
            alt="University of Utah Logo"
            style="width: 25%;float: right;">
        </div>
    </section>
</footer>
  </div>
</body>

</html>