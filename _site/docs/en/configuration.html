<!DOCTYPE html>
<html lang=" zh-CN ">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Personal Space Game</title>
    <meta name="viewport" content="width=device-width">
    <link rel="shortcut icon" href="/static/icon.png">
    <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.12.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5e158f966719b70012374cbf&product=inline-follow-buttons" async="async"></script>
    <script type="text/javascript">
        hljs.initHighlightingOnLoad();
    </script>
</head>

<body class="sideNavVisible">
  <div class="fixedHeaderContainer">
  <div class="headerWrapper wrapper">
    <header>
      <a href="/">
        <img class="logo" src="/static/icon.png">
        <h2 class="headerTitle">Personal Space</h2>
      </a>
      <div class="navigationWrapper navigationSlider">
        <nav class="slidingNav">
          <ul class="nav-site nav-site-internal">
            <li>
              <a href="" target="">
                Common Issues
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </header>
  </div>
</div>
  <div class="navPusher">
    <div class="docMainWrapper wrapper">
      <div class="container docsNavContainer" id="docsNav">
        <nav class="toc">
          <div class="toggleNav">
            <section class="navWrapper wrapper">
              <div class="navBreadcrumb wrapper">
                <div class="navToggle" id="navToggler">
                  <i></i>
                </div>
                <h2>
                  <i>›</i>
                  <span>Configuration</span>
                </h2>
              </div>
              <div class="navGroups">

                

                
                <div class="navGroup navGroupActive">
                  <h3>Introduction</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="why-blade.html">Why Blade?</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="blade-design.html">Blade Design</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>Quick Start</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="create-application.html">Create Application</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="create-route.html">Create Route</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="add-static-file.html">Add Static File</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="render-view.html">Render View</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>Guide</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="installation.html">Installation</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="component.html">Component</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="route.html">Route</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="route-context.html">Route Context</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="request.html">HTTP Request</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="response.html">HTTP Response</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="webhook.html">WebHook</a>
                    </li>
                    
                    <li class="navListItem navItemActive">
                      <a class="navItem navItemActive" href="configuration.html">Configuration</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="templates.html">Template</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="logging.html">Logging</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="package-deploy.html">Package Deploy</a>
                    </li>
                    
                  </ul>
                </div>
                
                <div class="navGroup navGroupActive">
                  <h3>Advance</h3>
                  <ul>
                    
                    <li class="navListItem">
                      <a class="navItem" href="exception.html">Exception</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="schedule.html">Schedule Task</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="error-page.html">Error Page</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="listen-event.html">Listen Event</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="session-ext.html">Session Extension</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="custom-middleware.html">Custom Middleware</a>
                    </li>
                    
                    <li class="navListItem">
                      <a class="navItem" href="cli-args.html">Terminal Params</a>
                    </li>
                    
                  </ul>
                </div>
                
              </div>
            </section>
          </div>
          <script>
            var toggler = document.getElementById('navToggler');
            var nav = document.getElementById('docsNav');
            toggler.onclick = function () {
              nav.classList.toggle('docsSliderActive');
            };
          </script>
        </nav>
      </div>
      <div class="container mainContainer">
        <div class="wrapper">
          <div class="post">
            <header class="postHeader">
              <a class="edit-page-link button" href="https://github.com/lets-blade/lets-blade.github.io/edit/master/docs/en/configuration.md"
                target="_blank">
                Edit Page
              </a>
              <h1>Configuration</h1>
            </header>
            <article>
              <div>
                <p>
                  <p>Configuration in Web development is a very common feature, I believe that there is no absolute zero configuration, even if the encoding is a configuration,
Moreover, the configuration of code writing needs to be re-encoded in the Java language to be modified, and it is very troublesome to modify the code in the production environment.</p>

<p>The concept of configuration in Blade is more simplified, of course, even if you do not use the configuration file, you can completely guarantee the normal operation of your project.
But the development of the program to the hands of every engineer is like magic, who will have a bold idea, we will meet you.</p>

<h2 id="create-configuration-file">Create configuration file</h2>
<p> 
We agreed that the configuration file created earlier is named <code class="highlighter-rouge">application.properties</code> and is located under <code class="highlighter-rouge">classpath</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>app.name<span class="o">=</span>HelloBlade
app.version<span class="o">=</span>0.0.1
jdbc.url<span class="o">=</span>jdbc:mysql://127.0.0.1:3306/app
jdbc.username<span class="o">=</span>root
jdbc.password<span class="o">=</span>123456
com.blade.logger.dir<span class="o">=</span>./logs
</code></pre></div></div>

<p>This is a simple, common configuration in which we specify the name, version, JDBC configuration, and location of the log files.</p>

<h2 id="read-configuration">Read configuration</h2>

<p>Sometimes we need to get the configuration in the program, for example, I need to display the version number in <code class="highlighter-rouge">app.version</code> on the webpage.
Then you only need to get the configuration when the route is executed or at startup, and then store it in <code class="highlighter-rouge">Request#attribute</code>.</p>

<p><strong>Get configuration at startup</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Blade</span><span class="o">.</span><span class="na">of</span><span class="o">()</span>
     <span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="n">EventType</span><span class="o">.</span><span class="na">SERVER_STARTED</span><span class="o">,</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">version</span> <span class="o">=</span> <span class="n">WebContext</span><span class="o">.</span><span class="na">blade</span><span class="o">().</span><span class="na">env</span><span class="o">(</span><span class="s">"app.version"</span><span class="o">,</span> <span class="s">"0.0.1"</span><span class="o">);</span>
        <span class="c1">// Then store the version variable in a constant field for long-term use</span>
     <span class="o">});</span>
</code></pre></div></div>

<p><strong>Obtained when the route is executed</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">someRoute</span><span class="o">(){</span>
    <span class="n">String</span> <span class="n">version</span> <span class="o">=</span> <span class="n">WebContext</span><span class="o">.</span><span class="na">blade</span><span class="o">().</span><span class="na">env</span><span class="o">(</span><span class="s">"app.version"</span><span class="o">,</span> <span class="s">"0.0.1"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The above is more rude, sometimes we are more accustomed to loading the template engine configuration or database configuration.
Let’s take an example. I load the database configuration along with the template configuration and write a configuration class that implements the <code class="highlighter-rouge">BladeLoader</code> interface.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoadConfig</span> <span class="kd">implements</span> <span class="n">BladeLoader</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">load</span><span class="o">(</span><span class="n">Blade</span> <span class="n">blade</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">version</span> <span class="o">=</span> <span class="n">blade</span><span class="o">.</span><span class="na">env</span><span class="o">(</span><span class="s">"app.version"</span><span class="o">,</span> <span class="s">"0.0.1"</span><span class="o">);</span>

        <span class="c1">// configuration database</span>
        <span class="n">DruidDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DruidDataSource</span><span class="o">();</span>

        <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClassName</span><span class="o">(</span><span class="s">"jdbc.driver"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="s">"jdbc.url"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"jdbc.username"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"jdbc.password"</span><span class="o">);</span>

        <span class="n">dataSource</span><span class="o">.</span><span class="na">setInitialSize</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setMaxActive</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setMinIdle</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setMaxWait</span><span class="o">(</span><span class="mi">6000</span><span class="o">);</span>

        <span class="n">Anima</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>

        <span class="c1">// configuration template engine</span>
        <span class="n">JetbrickTemplateEngine</span> <span class="n">templateEngine</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JetbrickTemplateEngine</span><span class="o">();</span>
        <span class="n">templateEngine</span><span class="o">.</span><span class="na">getGlobalContext</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="s">"version"</span><span class="o">,</span> <span class="n">version</span><span class="o">);</span>
        <span class="n">blade</span><span class="o">.</span><span class="na">templateEngine</span><span class="o">(</span><span class="n">templateEngine</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p>Here the database uses the <code class="highlighter-rouge">druid</code> connection pool and the template engine uses <code class="highlighter-rouge">blade-template-jetbrick</code></p>
</blockquote>

<p>We will read the <code class="highlighter-rouge">version</code> stored in the template engine context object and use <code class="highlighter-rouge">${version}</code> in all templates.</p>

<h2 id="configuration-list">Configuration list</h2>

<h3 id="basic-configuration">Basic configuration</h3>

<table>
  <thead>
    <tr>
      <th>Configuration</th>
      <th>Description</th>
      <th>Default Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>server.address</td>
      <td>web server address</td>
      <td>0.0.0.0</td>
    </tr>
    <tr>
      <td>server.port</td>
      <td>web server port</td>
      <td>9000</td>
    </tr>
    <tr>
      <td>app.devMode</td>
      <td>is it a developer mode</td>
      <td>true</td>
    </tr>
    <tr>
      <td>app.name</td>
      <td>app name</td>
      <td>blade</td>
    </tr>
    <tr>
      <td>app.thread-name</td>
      <td>start thread name</td>
      <td><em>(:3」∠)</em></td>
    </tr>
    <tr>
      <td>app.banner-path</td>
      <td>start banner path</td>
      <td>NULL</td>
    </tr>
    <tr>
      <td>app.context-path</td>
      <td>context path</td>
      <td>/</td>
    </tr>
    <tr>
      <td>app.task.thread-count</td>
      <td>task thread count</td>
      <td>CPU Core*2 + 1</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>Exceptions in developer mode are output on the web, and the production environment should be avoided</p>
</blockquote>

<h3 id="mvc-configuration">MVC configuration</h3>

<table>
  <thead>
    <tr>
      <th>配置</th>
      <th>描述</th>
      <th>默认值</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>mvc.view.404</td>
      <td>404页面地址</td>
      <td>无</td>
    </tr>
    <tr>
      <td>mvc.view.500</td>
      <td>500页面地址</td>
      <td>无</td>
    </tr>
    <tr>
      <td>mvc.statics</td>
      <td>静态资源目录，多个用逗号隔开.</td>
      <td>/static/,/upload/</td>
    </tr>
    <tr>
      <td>mvc.statics.show-list</td>
      <td>是否显示文件列表，显示后类似于FTP服务</td>
      <td>false</td>
    </tr>
    <tr>
      <td>mvc.template.path</td>
      <td>模板文件目录,位于classpath</td>
      <td>templates</td>
    </tr>
  </tbody>
</table>

<h3 id="http-configuration">HTTP configuration</h3>

<table>
  <thead>
    <tr>
      <th>Configuration</th>
      <th>Description</th>
      <th>Default Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>http.gzip.enable</td>
      <td>enable gzip compression</td>
      <td>false</td>
    </tr>
    <tr>
      <td>http.cors.enable</td>
      <td>enable cors compression</td>
      <td>false</td>
    </tr>
    <tr>
      <td>http.session.key</td>
      <td>session id in cookie</td>
      <td>SESSION</td>
    </tr>
    <tr>
      <td>http.session.timeout</td>
      <td>session timeout, unit/seconds</td>
      <td>1800</td>
    </tr>
  </tbody>
</table>

<h3 id="ssl-configuration">SSL configuration</h3>

<p>This configuration can be used when you want to use Blade directly to build a <code class="highlighter-rouge">https</code> site, but I don’t recommend this.
If your server has only one site, you can do this, otherwise you should use a professional user like <code class="highlighter-rouge">nginx</code>.</p>

<table>
  <thead>
    <tr>
      <th>Configuration</th>
      <th>Description</th>
      <th>Default Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>server.ssl.enable</td>
      <td>enable SSL</td>
      <td>false</td>
    </tr>
    <tr>
      <td>server.ssl.cert-path</td>
      <td>X.509 certificate chain file path, e.g: <code class="highlighter-rouge">cert.pem</code></td>
      <td>NULL</td>
    </tr>
    <tr>
      <td>server.ssl.private-key-path</td>
      <td>private key file path, e.g: <code class="highlighter-rouge">private.pem</code></td>
      <td>NULL</td>
    </tr>
    <tr>
      <td>server.ssl.private-key-pass</td>
      <td>private key password(if so)</td>
      <td>NULL</td>
    </tr>
  </tbody>
</table>

<h2 id="best-practices">Best Practices</h2>

<p>We have probably explained how the configuration file is played through the above explanations and examples. Here are some tips to tell you.</p>

<ol>
  <li>Parameter prefix magic</li>
  <li>Configuration environment differentiation</li>
</ol>

<p><strong>Parameter prefix magic</strong></p>

<p>In the previous example, we can feel that reading the configuration file is a simple matter. When there are too many parameters, we can identify different configuration scenarios with different prefixes.
For example, use <code class="highlighter-rouge">jdbc</code> to start with the database configuration, and <code class="highlighter-rouge">mail</code> to indicate the mail-related configuration.</p>

<p>Support for getting configurations based on prefixes in Blade, like the previous example we can modify to this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Environment</span> <span class="n">environment</span> <span class="o">=</span> <span class="n">blade</span><span class="o">.</span><span class="na">environment</span><span class="o">();</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="na">getPrefix</span><span class="o">(</span><span class="s">"jdbc"</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="s">"database"</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">JdbcConfig</span> <span class="n">jdbcConfig</span> <span class="o">=</span> <span class="n">JdbcConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">driver</span><span class="o">(</span><span class="s">"com.mysql.jdbc.Driver"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">url</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"url"</span><span class="o">).</span><span class="na">toString</span><span class="o">())</span>
            <span class="o">.</span><span class="na">username</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"username"</span><span class="o">).</span><span class="na">toString</span><span class="o">())</span>
            <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"password"</span><span class="o">).</span><span class="na">toString</span><span class="o">())</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>
<p>The Java language is an object-oriented language. Many times we convert data to objects for management. The configuration that starts with <code class="highlighter-rouge">jdbc</code> can be represented by the above code.
When there are many types of configuration, write a class to read the configuration and use the object to operate.</p>

<p><strong>Configuration environment distinction</strong></p>

<p>Sometimes the local environment configuration and production are different, such as database configuration, then the most stupid way is to modify the configuration of the production environment after going online.
To solve this problem, Blade uses environment configuration to improve usage. We think <code class="highlighter-rouge">application.properties</code> is a default configuration file.
Users can extend it, and your environment configuration will override the default configuration at startup.</p>

<p>Suppose my production environment database configuration is different from the local one, but the others are the same, so how do I do this?</p>

<p><em>Retain current configuration to create a production environment configuration</em></p>

<p>named <code class="highlighter-rouge">application-prod.properties</code> and <code class="highlighter-rouge">application.properties</code> files are in the same directory.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jdbc.url<span class="o">=</span>jdbc:mysql://10.33.<span class="k">**</span>.44:3328/app
jdbc.username<span class="o">=</span>username
jdbc.password<span class="o">=</span>passs<span class="k">**</span>word
</code></pre></div></div>

<p>Just do this, we can see that the same place will also use the <code class="highlighter-rouge">application.properties</code> file content.
Different in the new environment configuration, you only need to add environmental parameters when starting up.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java <span class="nt">-jar</span> app.jar <span class="nt">--app</span>.env<span class="o">=</span>prod
</code></pre></div></div>

                </p>
              </div>
            </article>
          </div>
          <!-- <div class="docs-prevnext">
            <a class="docs-next button" href="why-prettier.html">Why Prettier? →</a>
          </div> -->
        </div>
      </div>
    </div>
    <script id="twitter-wjs" sync src="https://platform.twitter.com/widgets.js"></script>
<script type="text/javascript" sync src="https://buttons.github.io/buttons.js"></script>

<footer class="footerSection nav-footer" id="footer">
    <section class="sitemap">
        <a href="/" class="nav-home">
            <img src="/static/icon.png" alt="Blade">
        </a>
        <div>
            <h5>Social Media</h5>
            <a href="https://twitter.com/PastelPeaks">@PastelPeaks on Twitter</a>
            <object type="image/svg+xml" data="https://img.shields.io/twitter/follow/PastelPeaks.svg?label=Follow+PastelPeaks&amp;style=social">
                <a href="https://twitter.com/intent/follow?screen_name=PastelPeaks">
                    <img alt="Follow us on Twitter" src="https://img.shields.io/twitter/follow/PastelPeaks.png?label=Follow+PastelPeaks&amp;style=social">
                </a>
            </object>
            <a href="https://www.instagram.com/PersonalSpaceGame/">@PersonalSpaceGame on Instagram</a>
        </div>
        <div>
            <img id="ulogo_pc" src="https://d1ggkj0laysj3f.cloudfront.net/wp-content/uploads/2018/10/29154938/GamerU-white-e1540850013969.png" 
            alt="University of Utah Logo"
            style="width: 25%; float: right;">

            <img id="ulogo_mobile" src="https://d1ggkj0laysj3f.cloudfront.net/wp-content/uploads/2018/10/29154938/GamerU-white-e1540850013969.png" 
            alt="University of Utah Logo"
            style="width: 25%;">
        </div>
    </section>
</footer>

<script>
    function _isMobile() {
        // if we want a more complete list use this: http://detectmobilebrowsers.com/
        // str.test() is more efficent than str.match()
        // remember str.test is case sensitive
        var isMobile = (/iphone|ipod|android|ie|blackberry|fennec/).test
            (navigator.userAgent.toLowerCase());
        return isMobile;
    }

    if (_isMobile()) {
        document.getElementById("ulogo_pc").style.display = "none";
    }
    else {
        document.getElementById("ulogo_mobile").style.display = "none";
    }

</script>
  </div>
</body>

</html>